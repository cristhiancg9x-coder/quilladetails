---
import Layout from '../layouts/Layout.astro';
import Navbar from '../components/Navbar.astro';
import UploadForm from '../components/UploadForm.jsx'; // El componente nuevo
import { supabase } from '../lib/supabase';

// --- SEGURIDAD DE SESIÓN ---
// Solo verificamos que el usuario esté logueado. 
// Ya NO manejamos la subida aquí (lo hace el componente React).

const accessToken = Astro.cookies.get("sb-access-token");
const refreshToken = Astro.cookies.get("sb-refresh-token");

if (!accessToken || !refreshToken) return Astro.redirect("/");

const { data: { session } } = await supabase.auth.setSession({
  access_token: accessToken.value,
  refresh_token: refreshToken.value,
});

if (!session) return Astro.redirect("/");
---

<Layout title="Subir Manualidad - QuillaDetails">
  <Navbar />
  
  <main class="min-h-screen pb-24 flex flex-col items-center justify-center p-4">
    
    <div class="w-full max-w-md">
      <h1 class="text-3xl font-bold text-center mb-6 text-white">
        Nueva <span class="text-cyber-rose">Creación</span>
      </h1>

      <UploadForm client:load userId={session.user.id} />
      
    </div>
  </main>
</Layout>